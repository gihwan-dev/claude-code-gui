#!/usr/bin/env bash
# protect-generated.sh â€” Block edits to auto-generated files
# PreToolUse hook: denies Write/Edit to generated files

set -euo pipefail

# Extract the file path from the tool input JSON
FILE_PATH=$(echo "${CLAUDE_TOOL_INPUT:-{}}" | jq -r '.file_path // .filePath // empty')

if [[ -z "$FILE_PATH" ]]; then
  exit 0
fi

# Check for protected files
case "$FILE_PATH" in
  */src/lib/bindings.ts|*/bindings.ts)
    jq -n '{
      decision: "block",
      reason: "bindings.ts is auto-generated by tauri-specta. Run `pnpm rust:bindings` to regenerate it instead of editing directly."
    }'
    ;;
  */pnpm-lock.yaml)
    jq -n '{
      decision: "block",
      reason: "pnpm-lock.yaml is auto-generated. Use `pnpm install` to update dependencies instead of editing directly."
    }'
    ;;
esac

exit 0
